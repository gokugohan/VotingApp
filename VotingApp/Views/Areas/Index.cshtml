@model VotingApp.Models.IndexAreaModel

@{
    ViewData["Title"] = "Areas";
}

<a href="#!" class="btn-add-new btn btn-success rounded-pill shadow-sm pull-right mb-3"><i class="fa fa-plus"></i> Create New</a>


<header class="text-center text-white mb-5">
    <h1 class="display-4">@ViewData["Title"]</h1>
    <p class="font-italic mb-0">Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit...</p>
</header>

<div class="card rounded shadow border-0">
    <div class="card-body p-5 bg-white rounded">
        <div class="row">
            <div class="col-md-12" id="municipality-container">
                <div class="table-responsive">

                    <table class="table" id="table-municipalities">
                        <thead>
                            <tr>
                                <th>Name</th>
                                @*<th></th>*@
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Municipalities)
                            {
                                <tr>
                                    <td>
                                        <a href="#!" class="btn-view-post-admin" data-id="@item.Id">@Html.DisplayFor(modelItem => item.Name)</a>
                                    </td>
                                    @*<td>
                                            <ul class="list-inline m-0">
                                                <li class="list-inline-item">
                                                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-primary btn-sm rounded-0" data-toggle="tooltip" data-placement="top" title="Update"><i class="fa fa-edit"></i></a>
                                                </li>
                                                <li class="list-inline-item">
                                                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-success btn-sm rounded-0" data-toggle="tooltip" data-placement="top" title="Detail"><i class="fa fa-eye-slash"></i></a>
                                                </li>
                                                <li class="list-inline-item">
                                                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm rounded-0" data-toggle="tooltip" data-placement="top" title="Delete"><i class="fa fa-trash"></i></a>
                                                </li>
                                            </ul>
                                        </td>*@
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-6 hide" id="municipality-child-area-container">
                <div class="table-responsive">
                    <table class="table table-striped" id="table-areas">
                        <thead>
                            <tr>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="modal fade" id="modal-view" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <ul class="list-group" id="list-of-area"></ul>
                </div>
            </div>
        </div>
    </div>
</div>


@section scripts{
    <script>
        $(document).ready(function () {

            $(".btn-add-new").on("click", function () {
                toastr.info("Upss");
            })

            $("body").on("click", ".btn-view-post-admin", function () {
                let id = $(this).data("id");
                $.ajax({
                    url: "/Areas/GetArea?level=" + 3 + "&parentId=" + id,
                    type: "get",
                    success: function (response) {
                        console.log(response);
                        $("#municipality-container").removeClass("col-md-12");
                        $("#municipality-container").addClass("col-md-6");

                        $("#municipality-child-area-container").removeClass("hide");

                        var tbody = "";
                        $.each(response.data, function (i, v) {
                            tbody += "<tr>";
                            tbody += "<td><a href='#!' data-id='" + v.id + "' data-title='" + v.name + "' class='btn-view-village'>" + v.name + "</a></td>";
                            tbody += "</tr>";
                        });


                        $("#table-areas tbody").html(tbody);
                    }
                })
            })

            $("body").on("click", ".btn-view-village", function () {
                let id = $(this).data("id");
                let title = $(this).data("title");
                $.ajax({
                    url: "/Areas/GetArea?level=" + 4 + "&parentId=" + id,
                    type: "get",
                    success: function (response) {
                        var li = "";
                        $.each(response.data, function (i, v) {
                            li += "<li class='list-group-item'>" + v.name + "</li>";
                        });


                        $("#list-of-area").html(li);

                        $("#modal-view .modal-title").html(title);
                        $("#modal-view").modal("show");
                    }
                })
            })
        });
    </script>
}